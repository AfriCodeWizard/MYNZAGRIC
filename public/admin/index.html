<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Content Manager</title>
  <script>
    // Log current URL info before Decap CMS loads
    console.log('=== Current Page Info ===');
    console.log('Full URL:', window.location.href);
    console.log('Origin:', window.location.origin);
    console.log('Pathname:', window.location.pathname);
    console.log('Hash:', window.location.hash);
    console.log('Search:', window.location.search);
    
    // Intercept fetch/XHR to see what Decap CMS is sending
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
      console.log('=== Fetch Request ===');
      console.log('URL:', args[0]);
      if (typeof args[0] === 'string' && args[0].includes('github.com/login/oauth')) {
        console.log('üîç GitHub OAuth request detected!');
        console.log('Full URL:', args[0]);
        const url = new URL(args[0]);
        console.log('Redirect URI in request:', url.searchParams.get('redirect_uri'));
      }
      return originalFetch.apply(this, args);
    };
    
    // Also intercept XMLHttpRequest
    const originalOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(method, url, ...rest) {
      console.log('=== XHR Request ===');
      console.log('Method:', method);
      console.log('URL:', url);
      if (typeof url === 'string' && url.includes('github.com/login/oauth')) {
        console.log('üîç GitHub OAuth XHR detected!');
        const urlObj = new URL(url);
        console.log('Redirect URI in request:', urlObj.searchParams.get('redirect_uri'));
      }
      return originalOpen.apply(this, [method, url, ...rest]);
    };
    
    // Intercept window.location changes (Decap CMS uses browser redirect for OAuth)
    let locationHrefDescriptor = Object.getOwnPropertyDescriptor(window, 'location') || 
                                 Object.getOwnPropertyDescriptor(Object.getPrototypeOf(window), 'location');
    
    Object.defineProperty(window, 'location', {
      get: function() {
        return locationHrefDescriptor.get.call(window);
      },
      set: function(value) {
        console.log('=== Window.location change detected ===');
        console.log('New location:', value);
        if (typeof value === 'string' && value.includes('github.com/login/oauth')) {
          console.log('üîçüîçüîç GitHub OAuth redirect detected!');
          try {
            const url = new URL(value);
            const redirectUri = url.searchParams.get('redirect_uri');
            console.log('üîç Redirect URI that Decap CMS is sending:', redirectUri);
            console.log('‚ö†Ô∏è ADD THIS EXACT URL TO GITHUB OAUTH APP CALLBACK URL!');
          } catch(e) {
            console.log('Could not parse URL:', e);
          }
        }
        return locationHrefDescriptor.set.call(window, value);
      },
      configurable: true
    });
    
    // Also intercept window.location.href directly
    const originalLocationReplace = window.location.replace;
    window.location.replace = function(url) {
      console.log('=== location.replace() called ===');
      console.log('URL:', url);
      if (typeof url === 'string' && url.includes('github.com/login/oauth')) {
        console.log('üîçüîçüîç GitHub OAuth redirect via replace()!');
        try {
          const urlObj = new URL(url);
          const redirectUri = urlObj.searchParams.get('redirect_uri');
          console.log('üîç Redirect URI:', redirectUri);
          console.log('‚ö†Ô∏è ADD THIS EXACT URL TO GITHUB OAUTH APP CALLBACK URL!');
        } catch(e) {
          console.log('Could not parse URL:', e);
        }
      }
      return originalLocationReplace.call(this, url);
    };
    
    // Wait for Decap CMS to load and check its config
    setTimeout(function() {
      if (window.CMS) {
        console.log('=== Decap CMS Config Check ===');
        const config = window.CMS.getConfig();
        if (config && config.backend) {
          console.log('Backend config:', config.backend);
          console.log('Base URL:', config.backend.base_url);
          console.log('Expected redirect_uri would be:', config.backend.base_url + '/admin');
          console.log('Or possibly:', config.backend.base_url + '/admin/');
          console.log('Or possibly:', config.backend.base_url + '/admin/index.html');
        }
      }
    }, 2000);
  </script>
</head>
<body>
  <div id="nc-root"></div>
  <!-- Load Decap CMS after DOM is ready -->
  <script src="https://unpkg.com/decap-cms@3.9.0/dist/decap-cms.js"></script>
</body>
</html>
